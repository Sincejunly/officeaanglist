<!DOCTYPE html>
<html>
<head>
    <title>文件分块上传示例</title>
</head>
<body>
    <h1>文件分块上传示例</h1>
    <input type="file" id="file-input">
    <button onclick="uploadFile()">上传文件</button>
    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const progressBar = document.getElementById('progress-bar');

        let currentChunk = 0;
        const chunkSize = 1024 * 1024; // 1MB

        async function uploadFile() {
            const file = fileInput.files[0];
            if (!file) return;

            const totalChunks = Math.ceil(file.size / chunkSize);

            for (let i = 0; i < totalChunks; i++) {
                const start = i * chunkSize;
                const end = Math.min((i + 1) * chunkSize, file.size);

                const chunk = file.slice(start, end);
                const formData = new FormData();

                formData.append('file', chunk, file.name); // 传递文件名

                const response = await fetch('http://127.0.0.1:5000/upload', {
                    method: 'POST',
                    body: formData,
                });

                if (response.ok) {
                    currentChunk++;
                    const percentComplete = (currentChunk / totalChunks) * 100;
                    progressBar.style.width = percentComplete + '%';
                } else {
                    alert('文件上传失败！');
                    return;
                }
            }

            alert('文件上传成功！');
        }
    </script>
</body>
</html>
